clc
clear all
close all

nameNetwork1   = 'SimpleGeneralNetwork';
nameNetwork2   = 'SiouxFalls';
pathDataFolder = '..\myRealData\';

nameNetwork = nameNetwork2;
G = ParseTNTP(pathDataFolder, nameNetwork);
% PlotNetwork(G);

Q = readmatrix([pathDataFolder nameNetwork2 '\SiouxFalls_trips.csv']);

ODs = [];
for i = 1:24
    for j = 1:24
        if i == j || Q(i, j) == 0
            continue;
        end
        ODs = [ODs; i, j, Q(i, j)];
    end
end



[x, it, xs] = CompNashFlowFW(G, ODs);
   
% extract vector values
FFT = G.Edges.FreeFlowTime;
B   = G.Edges.B;
Pow = G.Edges.Power;
Cap = G.Edges.Capacity;

% compute intermediate values
PowPlusOne = Pow + 1;
CapPow     = Cap .^ Pow;
BOverC     = B ./ CapPow;
CoeffPoly  = FFT .* BOverC ./ (Pow + 1);
CoeffLin   = FFT;

cost = [];
for i = 1:size(xs,2)
    xCurr = xs(:, i);
	cost = [cost sum(CoeffLin .* xCurr + CoeffPoly .* (xCurr .^ PowPlusOne))];
end

plot(1:it, cost);

xp = [3.67366622e+03 6.12659025e+03 9.80025644e+03 6.47339965e+03 ...
 2.02144218e-05 1.44505428e+04 9.34516451e+03 9.34323513e+03 ...
 2.01436207e+04 5.21154652e+03 1.51416637e+04 1.15232975e+04 ...
 1.69116776e+04 1.25999899e+04 7.78639780e+03 1.08952663e+04 ...
 1.32969468e+04 1.61725823e+04 1.32849567e+04 1.22743857e+04 ...
 7.26993042e+03 7.80169239e+03 1.56466203e+04 8.08215005e+03 ...
 2.16297386e+04 2.12769009e+04 1.76601320e+04 2.31295269e+04 ...
 1.15931530e+04 7.70381537e+03 5.20619579e+03 1.79348923e+04 ...
 8.16074379e+03 9.79006605e+03 8.32588193e+03 8.67906826e+03 ...
 1.28419226e+04 1.24409644e+04 1.13106815e+04 9.64115099e+03 ...
 9.18980878e+03 8.48605181e+03 2.26991586e+04 9.05878865e+03 ...
 2.04166213e+04 1.86472059e+04 8.35660215e+03 1.12989279e+04 ...
 1.18084327e+04 1.46670899e+04 7.70081097e+03 1.19278219e+04 ...
 1.01715981e+04 1.71951434e+04 1.48083853e+04 2.01356082e+04 ...
 1.99686636e+04 1.02879829e+04 9.70590959e+03 2.11994648e+04 ...
 9.37433664e+03 6.47354032e+03 7.40462946e+03 6.71221114e+03 ...
 8.46325171e+03 1.02355648e+04 1.84337753e+04 7.79824235e+03 ...
 8.46660345e+03 9.61310168e+03 8.46815687e+03 9.79663572e+03 ...
 7.67402561e+03 1.08097234e+04 1.04708839e+04 7.83966471e+03]';

xp2 = [
4495.364993
8115.406503
4516.462315
5967.254639
8094.309181
14025.773535
10035.403440
14046.763871
18022.575564
5210.870501
18046.678204
8798.661125
15788.647624
5988.351961
8807.440059
12495.071871
12103.124300
15801.021595
12524.948127
12040.813112
6881.026755
8389.067812
15803.971331
6833.698003
21754.967925
21822.962879
17726.361798
23126.029264
11046.960247
8100.444969
5307.758197
17604.371567
8366.383795
9781.357904
9993.315781
8399.631890
12305.421925
12396.582361
11119.077941
9823.007274
9033.232538
8396.661018
23187.753692
9078.720843
19080.556977
18403.747643
8403.961631
11074.308954
11685.583190
15289.755617
8101.357021
11674.284905
9952.841488
15863.332783
15343.296427
18992.509829
19112.826409
9942.455255
8684.038008
19008.361828
8705.921207
6306.563413
7002.604022
6242.816017
8614.367416
10307.186228
18378.690944
7004.086616
8604.773458
9660.398479
8392.822084
9627.230414
7899.459178
11110.238378
10253.032790
7862.452179  
];